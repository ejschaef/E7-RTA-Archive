/*! For license information please see test.bc1e9ac65edc607e74c9.bundle.js.LICENSE.txt */
(()=>{"use strict";function e(e){return e.replace(/\w\S*/g,e=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase())}const t={DE:"de",KO:"ko",PT:"pt",TH:"th",ZH_TW:"zh-TW",JA:"ja",EN:"en",FR:"fr",ZH_CN:"zh-CN",ES:"es"},n=new Set(["world_kor","world_global","world_jpn","world_asia","world_eu"]),r="world_global",o="world_kor",a="world_jpn",i="world_asia",c="world_eu",s={[r]:"Global",[o]:"Korea",[a]:"Japan",[i]:"Asia",[c]:"Europe"},u=Object.fromEntries(Object.values(s).map(e=>[e.toLowerCase(),e])),l={set_speed:"Speed",set_acc:"Hit",set_cri:"Critical",set_res:"Resist",set_def:"Defense",set_att:"Attack",set_max_hp:"Health",set_cri_dmg:"Destruction",set_coop:"Unity",set_immune:"Immunity",set_rage:"Rage",set_vampire:"Lifesteal",set_shield:"Protection",set_revenge:"Revenge",set_penetrate:"Penetration",set_torrent:"Torrent",set_counter:"Counter",set_scar:"Injury"},f=864e5,p={bronze:0,silver:1,gold:2,master:3,challenger:4,champion:5,warlord:6,emperor:7,legend:8},_=Object.fromEntries(Object.keys(p).sort((e,t)=>p[e]-p[t]).map(t=>[t,e(t)])),d={SEASON:"Season",SEASON_CODE:"Season Code",DATE_TIME:"Date/Time",SECONDS:"Seconds",TURNS:"Turns",SEQ_NUM:"Seq Num",P1_ID:"P1 ID",P1_SERVER:"P1 Server",P2_ID:"P2 ID",P2_SERVER:"P2 Server",P1_LEAGUE:"P1 League",P2_LEAGUE:"P2 League",P1_POINTS:"P1 Points",POINT_GAIN:"Point Gain",WIN:"Win",FIRST_PICK:"First Pick",FIRST_TURN:"First Turn",FIRST_TURN_HERO:"First Turn Hero",CR_BAR:"CR Bar",P1_PREBANS:"P1 Prebans",P2_PREBANS:"P2 Prebans",P1_PICKS:"P1 Picks",P2_PICKS:"P2 Picks",P1_POSTBAN:"P1 Postban",P2_POSTBAN:"P2 Postban",P1_EQUIPMENT:"P1 Equipment",P2_EQUIPMENT:"P2 Equipment",P1_ARTIFACTS:"P1 Artifacts",P2_ARTIFACTS:"P2 Artifacts",P1_MVP:"P1 MVP",P2_MVP:"P2 MVP",P1_PICKS_PRIMES:"P1 Picks Primes",P1_PICKS_PRIME_PRODUCT:"P1 Picks Prime Product",P2_PICKS_PRIMES:"P2 Picks Primes",P2_PICKS_PRIME_PRODUCT:"P2 Picks Prime Product",P1_PREBANS_PRIMES:"P1 Prebans Primes",P1_PREBANS_PRIME_PRODUCT:"P1 Prebans Prime Product",P2_PREBANS_PRIMES:"P2 Prebans Primes",P2_PREBANS_PRIME_PRODUCT:"P2 Prebans Prime Product"},S=(Object.values(d).filter(e=>!e.toLowerCase().includes("prime")),[d.P1_EQUIPMENT,d.P2_EQUIPMENT,d.P1_ARTIFACTS,d.P2_ARTIFACTS,d.CR_BAR,d.P1_PREBANS,d.P2_PREBANS,d.P1_PICKS,d.P2_PICKS]),h=[d.FIRST_PICK,d.FIRST_TURN,d.WIN],y=[d.SECONDS,d.TURNS,d.P1_POINTS,d.POINT_GAIN],m=[d.P1_LEAGUE,d.P2_LEAGUE],E="Hero Name",P="Battles",g="Pick Rate",v="Wins",b="Win rate",w="Postbans",A="Postban Rate",T="Success Rate",R="+/-",I="Point Gain",N="Avg CR",O="First Turns",C="First Turn Rate";const D=function(e){const t=new Uint8Array(e+1),n=[];for(let r=2;r<=e;r++)if(!t[r]){n.push(r);for(let n=r*r;n<=e;n+=r)t[n]=1}return n}(3e4);async function L(e){try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error: status: ${t.status}`);const n=await t.json();return Object.keys(n),n}catch(e){return console.error("Error fetching global user data:",e),null}}const M={fetchHeroJSON:async function(e=null){let t=await L("https://static.smilegatemegaport.com/gameRecord/epic7/epic7_hero.json");return t?(e&&t[e]?t=t[e]:e&&!t[e]&&(console.error("Could not find hero data for language:",e),t=null),t):null},fetchUserJSON:async function(e){if(e=e.replace("world_",""),![...n].some(t=>t.replace("world_","")===e))return console.error(`Could not find world code: ${e}`),null;const t=`https://static.smilegatemegaport.com/gameRecord/epic7/epic7_user_world_${e}.json`,r=await L(t);return r&&"object"==typeof r&&"users"in r&&Array.isArray(r.users)&&r.users.length,r},fetchArtifactJSON:async function(e=null){let t=await L("https://static.smilegatemegaport.com/gameRecord/epic7/epic7_artifact.json"),n=null;if(t&&e&&"object"==typeof t&&e in t){let n=t;if(Array.isArray(n[e]))return n[e]}return n},fetchInfo:async function(e,t,n="en"){const r=new URLSearchParams({nick_no:e,world_code:t,lang:n});try{const e=await fetch("https://epic7.onstove.com/gg/gameApi/getUserInfo",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r.toString()});if(!e.ok)return console.error("Error fetching battle list:",e.status,e.statusText),null;return await e.json()}catch(e){return console.error("Request failed:",e),null}}};function j(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var s=r&&r.prototype instanceof c?r:c,u=Object.create(s.prototype);return k(u,"_invoke",function(n,r,o){var a,c,s,u=0,l=o||[],f=!1,p={p:0,n:0,v:e,a:_,f:_.bind(e,4),d:function(t,n){return a=t,c=0,s=e,p.n=n,i}};function _(n,r){for(c=n,s=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,a=l[t],_=p.p,d=a[2];n>3?(o=d===r)&&(s=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=_&&((o=n<2&&_<a[1])?(c=0,p.v=r,p.n=a[1]):_<d&&(o=n<3||a[0]>r||r>d)&&(a[4]=n,a[5]=r,p.n=d,c=0))}if(o||n>1)return i;throw f=!0,r}return function(o,l,d){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&_(l,d),c=l,s=d;(t=c<2?e:s)||!f;){a||(c?c<3?(c>1&&(p.n=-1),_(c,s)):p.n=s:p.v=s);try{if(u=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((t=(f=p.n<0)?s:n.call(r,p))!==i)break}catch(t){a=e,c=1,s=t}finally{u=1}}return{value:t,done:f}}}(n,o,a),!0),u}var i={};function c(){}function s(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(k(t={},r,function(){return this}),t),f=u.prototype=c.prototype=Object.create(l);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,k(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return s.prototype=u,k(f,"constructor",u),k(u,"constructor",s),s.displayName="GeneratorFunction",k(u,o,"GeneratorFunction"),k(f),k(f,o,"Generator"),k(f,r,function(){return this}),k(f,"toString",function(){return"[object Generator]"}),(j=function(){return{w:a,m:p}})()}function k(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}k=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){k(e,t,function(e){return this._invoke(t,n,e)})};a("next",0),a("throw",1),a("return",2)}},k(e,t,n,r)}function B(e,t,n,r,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function F(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){B(a,r,o,i,c,"next",e)}function c(e){B(a,r,o,i,c,"throw",e)}i(void 0)})}}var U,x,K,$,G,H;const W={test:function(e){e.rank_plot},fetchFromPython:(H=F(j().m(function e(t){var n,r;return j().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,fetch(t);case 1:if((n=e.v).ok){e.n=3;break}return e.n=2,fetch(t);case 2:n=e.v;case 3:return e.n=4,n.json();case 4:return r=e.v,e.a(2,r||null)}},e)})),function(e){return H.apply(this,arguments)}),fetchHeroData:(G=F(j().m(function e(){return j().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.fetchFromPython("/api/get_hero_data");case 1:return e.a(2,e.v)}},e,this)})),function(){return G.apply(this,arguments)}),rsFetchBattleData:($=F(j().m(function e(t){return j().w(function(e){for(;;)switch(e.n){case 0:if(t){e.n=1;break}throw new Error("Must pass user to fetch battles data");case 1:return e.n=2,fetch("/api/rs_get_battle_data",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:t})});case 2:return e.a(2,e.v)}},e)})),function(e){return $.apply(this,arguments)}),fetchSeasonDetails:(K=F(j().m(function e(){var t,n,r;return j().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,fetch("/api/get_season_details");case 1:return t=e.v,e.n=2,t.json();case 2:if(!(n=e.v).success){e.n=3;break}return r=JSON.parse(n.seasonDetails),e.a(2,{seasonDetails:r,error:!1});case 3:return e.a(2,{seasonDetails:null,error:n.error});case 4:return e.a(2)}},e)})),function(){return K.apply(this,arguments)}),fetchArtifactJson:(x=F(j().m(function e(){var t,n,r;return j().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,fetch("/api/get_artifact_json");case 1:return t=e.v,e.n=2,t.json();case 2:if(!(n=e.v).success){e.n=3;break}return r=JSON.parse(n.artifactJson),e.a(2,r);case 3:return e.a(2,null);case 4:return e.a(2)}},e)})),function(){return x.apply(this,arguments)}),fetchUser:(U=F(j().m(function e(t){var n,r,o;return j().w(function(e){for(;;)switch(e.n){case 0:if(t.name&&t.world_code||t.id){e.n=1;break}throw new Error("Must pass a user object with either user.name and user.world_code or user.id to fetch user");case 1:return e.n=2,fetch("/api/get_user_data",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userData:t})});case 2:return n=e.v,e.n=3,n.json();case 3:if(r=e.v,n.ok){e.n=4;break}throw new Error("Flask server error: ".concat(r.error));case 4:if(r.foundUser){e.n=6;break}if(t.world_code){e.n=5;break}return e.a(2,{user:null,ok:!0});case 5:return e.a(2,{user:null,ok:!0});case 6:return o=r.user,"Found user: ".concat(JSON.stringify(o)),e.a(2,{user:o,ok:!0})}},e)})),function(e){return U.apply(this,arguments)})},J=(e,t)=>t.some(t=>e instanceof t);let V,q;const Q=new WeakMap,z=new WeakMap,Y=new WeakMap;let Z={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Q.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ne(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function X(e){Z=e(Z)}function ee(e){return(q||(q=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(re(this),t),ne(this.request)}:function(...t){return ne(e.apply(re(this),t))}}function te(e){return"function"==typeof e?ee(e):(e instanceof IDBTransaction&&function(e){if(Q.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",a),e.removeEventListener("abort",a)},o=()=>{t(),r()},a=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",o),e.addEventListener("error",a),e.addEventListener("abort",a)});Q.set(e,t)}(e),J(e,V||(V=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,Z):e)}function ne(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",a)},o=()=>{t(ne(e.result)),r()},a=()=>{n(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",a)});return Y.set(t,e),t}(e);if(z.has(e))return z.get(e);const t=te(e);return t!==e&&(z.set(e,t),Y.set(t,e)),t}const re=e=>Y.get(e);const oe=["get","getKey","getAll","getAllKeys","count"],ae=["put","add","delete","clear"],ie=new Map;function ce(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(ie.get(t))return ie.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,o=ae.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!o&&!oe.includes(n))return;const a=async function(e,...t){const a=this.transaction(e,o?"readwrite":"readonly");let i=a.store;return r&&(i=i.index(t.shift())),(await Promise.all([i[n](...t),o&&a.done]))[0]};return ie.set(t,a),a}X(e=>({...e,get:(t,n,r)=>ce(t,n)||e.get(t,n,r),has:(t,n)=>!!ce(t,n)||e.has(t,n)}));const se=["continue","continuePrimaryKey","advance"],ue={},le=new WeakMap,fe=new WeakMap,pe={get(e,t){if(!se.includes(t))return e[t];let n=ue[t];return n||(n=ue[t]=function(...e){le.set(this,fe.get(this)[t](...e))}),n}};async function*_e(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;const n=new Proxy(t,pe);for(fe.set(n,t),Y.set(n,re(t));t;)yield n,t=await(le.get(n)||t.continue()),le.delete(n)}function de(e,t){return t===Symbol.asyncIterator&&J(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&J(e,[IDBIndex,IDBObjectStore])}async function Se(e,t){const n=e.transaction(t,"readwrite");n.objectStore(t).clear(),await n.done}X(e=>({...e,get:(t,n,r)=>de(t,n)?_e:e.get(t,n,r),has:(t,n)=>de(t,n)||e.has(t,n)}));const he={USER:"current-user",BATTLES:"battles",RAW_UPLOAD:"raw-upload",UPLOADED_BATTLES:"uploaded-battles",FILTERED_BATTLES:"filtered-battles",STATS:"stats",FILTER_STR:"filter-str"},ye={GLOBAL_USERS:"global-users",EU_USERS:"eu-users",ASIA_USERS:"asia-users",JPN_USERS:"jpn-users",KOR_USERS:"kor-users"},me={...he,...ye,LANG:"lang",HERO_MANAGER:"hero-manager",SEASON_DETAILS:"season-details",AUTO_ZOOM_FLAG:"auto-zoom",AUTO_QUERY_FLAG:"auto-query",ID_SEARCH_FLAG:"id-search",ARTIFACTS:"artifacts",ARTIFACTS_LOWERCASE_NAMES_MAP:"artifacts-lowercase-names-map",ARTIFACT_OBJECT_LIST:"artifact-object-list",HOME_PAGE_STATE:"home-page-state",INTER_PAGE_MANAGER:"inter-page-manager"};let Ee={consts:{DB_NAME:"E7ArenaStatsClientDB",DB_VERSION:1,STORE_NAME:"DataStore",META_STORE_NAME:"MetaStore",CACHE_TIMEOUT:1728e5},Keys:{...me},MetaKeys:{TIMESTAMP:"timestamp"},loaded_UM:new Set,openDB:async()=>function(e,t,{blocked:n,upgrade:r,blocking:o,terminated:a}={}){const i=indexedDB.open(e,t),c=ne(i);return r&&i.addEventListener("upgradeneeded",e=>{r(ne(i.result),e.oldVersion,e.newVersion,ne(i.transaction),e)}),n&&i.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),c.then(e=>{a&&e.addEventListener("close",()=>a()),o&&e.addEventListener("versionchange",e=>o(e.oldVersion,e.newVersion,e))}).catch(()=>{}),c}(Ee.consts.DB_NAME,Ee.consts.DB_VERSION,{upgrade(e){e.objectStoreNames.contains(Ee.consts.STORE_NAME)&&e.deleteObjectStore(Ee.consts.STORE_NAME),e.objectStoreNames.contains(Ee.consts.STORE_NAME)||e.createObjectStore(Ee.consts.STORE_NAME),e.objectStoreNames.contains(Ee.consts.META_STORE_NAME)||e.createObjectStore(Ee.consts.META_STORE_NAME)}}),get:async function(e){const t=await this.openDB(),n=await t.get(this.consts.STORE_NAME,e);if(null===n)return null;return await this.checkCacheTimeout(e)?n:null},cache:async function(e,t){const n=await this.openDB();await n.put(this.consts.STORE_NAME,t,e),await this.setTimestamp(e,Date.now())},delete:async function(e){const t=await this.openDB();await t.delete(this.consts.STORE_NAME,e),await this.deleteTimestamp(e)},deleteDB:async function(){await indexedDB.deleteDatabase(this.consts.DB_NAME)},getTimestamp:async function(e){const t=await this.openDB(),n=`${e+this.MetaKeys.TIMESTAMP}`;return await t.get(this.consts.META_STORE_NAME,n)??0},setTimestamp:async function(e,t){const n=await this.openDB(),r=`${e+this.MetaKeys.TIMESTAMP}`;await n.put(this.consts.META_STORE_NAME,t,r),await n.get(this.consts.META_STORE_NAME,r)},deleteTimestamp:async function(e){const t=await this.openDB(),n=`${e+this.MetaKeys.TIMESTAMP}`;await t.delete(this.consts.META_STORE_NAME,n)},clearData:async function(){const e=await this.openDB();await Se(e,this.consts.STORE_NAME),await Se(e,this.consts.META_STORE_NAME)},clearUserData:async function(){const e=Object.values(he);await Promise.all(e.map(e=>this.delete(e)))},clearUserLists:async function(){const e=Object.values(ye);await Promise.all(e.map(e=>this.delete(e)))},clearSeasonData:async function(){await this.delete(me.SEASON_DETAILS)},checkCacheTimeout:async function(e){const t=await this.getTimestamp(e),n=Date.now();return!(!t||n-t>Ee.consts.CACHE_TIMEOUT)||(await this.delete(e),!1)},getFilterStr:async function(){return await this.get(Ee.Keys.FILTER_STR)},setFilterStr:async function(e){await this.cache(Ee.Keys.FILTER_STR,e)},getLang:async function(){return await this.get(Ee.Keys.LANG)??t.EN},setLang:async function(e){await this.cache(Ee.Keys.LANG,e)},getStats:async function(){return await this.get(Ee.Keys.STATS)},setStats:async function(e){await this.cache(me.STATS,e)}};const Pe=Ee;const ge={getHeroDicts:async function(e=t.EN){const n=await Pe.get(Pe.Keys.HERO_MANAGER);return n||this.fetchAndCacheHeroManager(e)},createHeroManager:function(e){for(let[t,n]of e.entries()){const e=D[t];n.prime=e}let t={heroes:[],Empty:{attribute_cd:"N/A",code:"N/A",grade:"N/A",job_cd:"N/A",name:"N/A",prime:1},Fodder:{attribute_cd:"N/A",code:"N/A",grade:"N/A",job_cd:"N/A",name:"N/A",prime:1},name_lookup:{},code_lookup:{},prime_lookup:{},prime_pair_lookup:{}};return t.heroes=e,t=function(e){const t=e.heroes.length,n={attribute_cd:"N/A",code:"N/A",grade:"N/A",job_cd:"N/A",name:"Empty",prime:1},r={attribute_cd:"N/A",code:"N/A",grade:"2/3",job_cd:"N/A",name:"Fodder",prime:D[t]};return e.heroes.push(n),e.heroes.push(r),e.Fodder=r,e.Empty=n,e}(t),t=function(e){e.name_lookup=e.heroes.reduce((e,t)=>(e[t.name.toLowerCase().replace(/\s+/g,"")]=t,e),{}),e.prime_lookup=e.heroes.reduce((e,t)=>(e[t.prime]=t,e),{}),e.code_lookup=e.heroes.reduce((e,t)=>(e[t.code]=t,e),{});let t=e.heroes.reduce((e,t)=>(e[t.prime]=t.name,e),{});const n=Object.keys(e.prime_lookup).length-1;for(let r=0;r<n-1;r++){const o=D[r];for(let a=r+1;a<n;a++){const n=D[a],r=o*n,i=e.prime_lookup[o].name,c=e.prime_lookup[n].name;t[r]=[i,c].sort().join(", ")}}return t[e.Fodder.prime*e.Fodder.prime]=[e.Fodder.name,e.Fodder.name].join(", "),e.prime_pair_lookup=t,e}(t),t},fetchHeroManager:async function(e=t.EN){const n=(await M.fetchHeroJSON()??await W.fetchHeroData())[e];return this.createHeroManager(n)},fetchAndCacheHeroManager:async function(e=t.EN){const n=await this.fetchHeroManager(e);return await Pe.cache(Pe.Keys.HERO_MANAGER,n),n},deleteHeroManager:async function(){await Pe.delete(Pe.Keys.HERO_MANAGER)},getHeroByName:function(e,t){if(!t)throw new Error("HeroManager instance must be passed to lookup functions");if(!e)return t.Empty;const n=e.toLowerCase().replace(/\s+/g,"");return t.name_lookup[n]??null},getHeroByPrime:function(e,t){if(!t)throw new Error("HeroManager instance must be passed to lookup functions");return t.prime_lookup[e]},getHeroByCode:function(e,t){if(!t)throw new Error("HeroManager instance must be passed to lookup functions");return e?t.code_lookup[e]??null:t.Empty},getPairNamesByProduct:function(e,t){if(!t)throw new Error("HeroManager instance must be passed to lookup functions");return t.prime_pair_lookup[e]}};function ve(e){return ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ve(e)}function be(e){return function(e){if(Array.isArray(e))return Ie(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Re(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function we(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,c=[],s=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=a.call(n)).done)&&(c.push(r.value),c.length!==t);s=!0);}catch(e){u=!0,o=e}finally{try{if(!s&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(u)throw o}}return c}}(e,t)||Re(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ae(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=ve(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=ve(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ve(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Te(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Re(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw a}}}}function Re(e,t){if(e){if("string"==typeof e)return Ie(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ie(e,t):void 0}}function Ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Ne=function(e){return e.filter(function(e){return e[d.FIRST_PICK]})};function Oe(e){return(100*e).toFixed(2)+"%"}function Ce(e,t){return Oe(0!==t?e/t:0)}function De(e,t){var n=e[d.CR_BAR].find(function(e){return e[0]===t});return n?n[1]:null}function Le(e,t,n){var r,o,a=function(e){return e.filter(function(e){return e[d.WIN]})}(e).length,i=e.length,c=0!==t?i/t:0,s=0!==i?a/i:0,u=e.reduce(function(e,t){return e+(t[d.P1_POSTBAN]===n||t[d.P2_POSTBAN]===n)},0),l=e.reduce(function(e,t){return e+(t[d.WIN]||t[d.P1_POSTBAN]===n||t[d.P2_POSTBAN]===n)},0),f=e.reduce(function(e,t){return e+t[d.POINT_GAIN]},0),p=0,_=0,S=0,h=Te(e);try{for(h.s();!(o=h.n()).done;){var y=De(o.value,n);null!==y&&0!==y&&(p+=1,_+=y,100===y&&(S+=1))}}catch(e){h.e(e)}finally{h.f()}var m=Ce(_/100,p);return Ae(Ae(Ae(Ae(Ae(Ae(Ae(Ae(Ae(Ae(r={},E,n),P,i),g,Oe(c)),v,a),b,Oe(s)),w,u),A,Ce(u,i)),T,Ce(l,i)),R,2*a-i),I,f),Ae(Ae(Ae(r,N,m),O,S),C,Ce(S,p))}function Me(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=new Set,r=0,o=Object.values(e);r<o.length;r++){var a=o[r];(t?a[d.P1_PICKS_PRIMES]:a[d.P2_PICKS_PRIMES]).forEach(function(e){n.add(e)})}return n}function je(e){var t=Math.floor(e/60),n=(e%60).toFixed(1);return 0===t?"".concat(n," secs"):"".concat(t," : ").concat(n,"s")}const ke={getHeroStats:function(e,t){if(0===e.length)return{playerHeroStats:[],enemyHeroStats:[]};var n,r=e.length,o=Me(e,!0),a=Me(e,!1),i=[],c=[],s=Te(o);try{var u=function(){var o=n.value,a=ge.getHeroByPrime(o,t),c=e.filter(function(e){return e[d.P1_PICKS_PRIME_PRODUCT]%o===0});c.length>0&&i.push(Le(c,r,a.name))};for(s.s();!(n=s.n()).done;)u()}catch(e){s.e(e)}finally{s.f()}var l,f=Te(a);try{var p=function(){var n=l.value,o=ge.getHeroByPrime(n,t),a=e.filter(function(e){return e[d.P2_PICKS_PRIME_PRODUCT]%n===0});a.length>0&&c.push(Le(a,r,o.name))};for(f.s();!(l=f.n()).done;)p()}catch(e){f.e(e)}finally{f.f()}var _=E;return{playerHeroStats:i.sort(function(e,t){return e[_].localeCompare(t[_])}),enemyHeroStats:c.sort(function(e,t){return e[_].localeCompare(t[_])})}},getFirstPickStats:function(e,t){if(0===(e=Ne(Object.values(e))).length)return[];var n,r=e.length,o={},a=Te(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(0!==i[d.P1_PICKS_PRIMES].length){var c=i[d.P1_PICKS_PRIMES][0];c in o||(o[c]={wins:0,appearances:0}),o[c].wins+=i[d.WIN],o[c].appearances+=1}}}catch(e){a.e(e)}finally{a.f()}var s=Object.entries(o).map(function(e){var n=we(e,2),o=n[0],a=n[1];return{hero:ge.getHeroByPrime(o,t).name,wins:a.wins,appearances:a.appearances,win_rate:Oe(a.wins/a.appearances),appearance_rate:Oe(a.appearances/r),"+/-":2*a.wins-a.appearances}});return s.sort(function(e,t){return t.appearances-e.appearances}),s},getPrebanStats:function(e,t){var n=ge.getHeroByName("Empty",t).prime;if(0===e.length)return[];var r,o=function(t,r){return be(new Set(e.map(function(e){return e[t][r]}).filter(function(e){return e&&e!==n})))},a=o(d.P1_PREBANS_PRIMES,0),i=o(d.P1_PREBANS_PRIMES,1),c=new Set([].concat(be(a),be(i))),s=[],u=Te(c);try{for(u.s();!(r=u.n()).done;){var l=r.value;s.push(l)}}catch(e){u.e(e)}finally{u.f()}var f,p=Te(c);try{for(p.s();!(f=p.n()).done;){var _,S=f.value,h=Te(c);try{for(h.s();!(_=h.n()).done;){var y=_.value;S<y&&s.push(S*y)}}catch(e){h.e(e)}finally{h.f()}}}catch(e){p.e(e)}finally{p.f()}for(var m=e.length,E=[],P=function(){var n=v[g],r=e.filter(function(e){return e["P1 Prebans Prime Product"]%n===0}),o=r.length;if(o<1)return 1;var a=r.reduce(function(e,t){return e+t.Win},0),i=m>0?o/m:0,c=o>0?a/o:0,s=2*a-o;E.push({preban:t.prime_pair_lookup[n],wins:a,appearances:o,appearance_rate:Oe(i),win_rate:Oe(c),"+/-":s})},g=0,v=s;g<v.length;g++)P();return E.sort(function(e,t){return t.appearances-e.appearances}),E},getPerformanceStats:function(e){var t,n={servers:[],leagues:[]},r=e.length,o=Object.values(s),a=Object.values(_),i=Te([].concat(be(o.map(function(e){return["Server: ".concat(e),function(t){return t["P2 Server"]===e}]})),be(a.map(function(e){return["League: ".concat(e),function(t){return t["P2 League"]===e}]}))));try{for(i.s();!(t=i.n()).done;){var c=we(t.value,2),u=c[0],l=c[1],f=e.filter(l);if(0!==f.length){var p=f.length,d=f.reduce(function(e,t){return e+t.Win},0),S=p>0?d/p:"N/A",h=r>0?p/r:"N/A",y=f.filter(function(e){return e["First Pick"]}),m=y.reduce(function(e,t){return e+t.Win},0),E=f.filter(function(e){return!e["First Pick"]}),P=E.reduce(function(e,t){return e+t.Win},0);(u.toLowerCase().includes("server")?n.servers:n.leagues).push({label:u,count:p,wins:d,win_rate:"N/A"===S?"N/A":Oe(S),frequency:Oe(h),"+/-":2*d-p,fp_games:y.length,sp_games:E.length,fp_wr:y.length>0?Oe(m/y.length):"N/A",sp_wr:E.length>0?Oe(P/E.length):"N/A"})}}}catch(e){i.e(e)}finally{i.f()}return[].concat(be(n.servers),be(n.leagues.slice(-4)))},getGeneralStats:function(e,t){e.sort(function(e,t){return new Date(e["Date/Time"])-new Date(t["Date/Time"])});var n,r=e.length,o=e.reduce(function(e,t){return e+t["Point Gain"]},0),a=r>0?o/r:0,i=e.reduce(function(e,t){return e+t.Turns},0),c=r>0?i/r:0,s=e.length>0?Math.max.apply(Math,be(e.map(function(e){return e.Turns}))):0,u=e.reduce(function(e,t){return e+t.Seconds},0),l=r>0?u/r:0,f=e.length>0?Math.max.apply(Math,be(e.map(function(e){return e.Seconds}))):0,p=je(l),_=je(f),S=e.reduce(function(e,t){return e+t["First Turn"]},0),h=Ne(e),y=function(e){return e.filter(function(e){return!e[d.FIRST_PICK]})}(e),m=h.length,E=y.length,P=h.reduce(function(e,t){return e+t.Win},0),g=y.reduce(function(e,t){return e+t.Win},0),v=r?m/r:0,b=r?E/r:0,w=m?P/m:0,A=E?g/E:0,T=r?(P+g)/r:0,R=0,I=0,N=0,O=0,C=Te(e);try{for(C.s();!(n=C.n()).done;){n.value.Win?(N+=1,R=Math.max(R,N),O=0):(N=0,O+=1,I=Math.max(I,O))}}catch(e){C.e(e)}finally{C.f()}var D="N/A";return{first_pick_count:m,second_pick_count:E,first_pick_rate:m?Oe(v):D,second_pick_rate:E?Oe(b):D,first_pick_winrate:m?Oe(w):D,second_pick_winrate:E?Oe(A):D,total_winrate:r?Oe(T):D,total_battles:r,total_wins:P+g,max_win_streak:R,max_loss_streak:I,avg_ppg:a.toFixed(2),avg_turns:c.toFixed(2),avg_time:p,max_turns:s,max_time:_,first_turn_games:S,first_turn_rate:r?Oe(S/r):D}}};const Be={async getArtifactCodeToNameMap(){let e=await Pe.get(Pe.Keys.ARTIFACTS);return e||(e=await this.fetchAndCacheArtifacts()),e},getArtifactLowercaseNameMap:async function(){let e=await Pe.get(Pe.Keys.ARTIFACTS_LOWERCASE_NAMES_MAP);if(null!==e)return e;const t=await this.getArtifactCodeToNameMap();return e=Object.fromEntries(Object.values(t).filter(e=>null!==e).map(e=>[e.toLowerCase(),e])),await Pe.cache(Pe.Keys.ARTIFACTS_LOWERCASE_NAMES_MAP,e),e},getArtifactObjectList:async function(){let e=await Pe.get(Pe.Keys.ARTIFACT_OBJECT_LIST);if(null!==e)return e;const t=await this.getArtifactCodeToNameMap();return e=Object.entries(t).map(([e,t])=>({id:e,name:t})),await Pe.cache(Pe.Keys.ARTIFACT_OBJECT_LIST,e),e},fetchAndCacheArtifacts:async function(){const e=await async function(){let e=await M.fetchArtifactJSON("en");return null===e&&(e=await W.fetchArtifactJson()),null===e?(console.error("Could not get artifact Json map from E7 server or flask server"),null):Object.fromEntries(e.filter(e=>null!==e.name).map(e=>[e.code,e.name]))}();return null===e?{}:(await Pe.cache(Pe.Keys.ARTIFACTS,e),e)},clearArtifactData:async function(){await Pe.delete(Pe.Keys.ARTIFACTS)},convertCodeToName:function(e,t){return t[e]||e}};function Fe(e){return Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fe(e)}function Ue(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return xe(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xe(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw a}}}}function xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Ke(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=Fe(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Fe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Fe(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $e(e,t){var n=function(e){var n,r;return null!==(n=null===(r=ge.getHeroByName(e,t))||void 0===r?void 0:r.prime)&&void 0!==n?n:t.Fodder.prime},r=function(e,t){return e*t};e[d.P1_PICKS_PRIMES]=e[d.P1_PICKS].map(n),e[d.P2_PICKS_PRIMES]=e[d.P2_PICKS].map(n),e[d.P1_PICKS_PRIME_PRODUCT]=e[d.P1_PICKS_PRIMES].reduce(r,1),e[d.P2_PICKS_PRIME_PRODUCT]=e[d.P2_PICKS_PRIMES].reduce(r,1),e[d.P1_PREBANS_PRIMES]=e[d.P1_PREBANS].map(n),e[d.P2_PREBANS_PRIMES]=e[d.P2_PREBANS].map(n),e[d.P1_PREBANS_PRIME_PRODUCT]=e[d.P1_PREBANS_PRIMES].reduce(r,1),e[d.P2_PREBANS_PRIME_PRODUCT]=e[d.P2_PREBANS_PRIMES].reduce(r,1)}function Ge(t,n,r){var o,a=function(e){var t,r;return null!==(t=null===(r=ge.getHeroByCode(e,n))||void 0===r?void 0:r.name)&&void 0!==t?t:n.Fodder.name},i=function(e,n){return n.map(function(n,o){return n?function(e){return Be.convertCodeToName(e,r)||"None"}(n):function(e,n){return"p1"===e?t.p2_postban===t.p1_picks[n]:t.p1_postban===t.p2_picks[n]}(e,o)?"n/a":"None"})},c=function(e){return e.map(function(e){return e.map(function(e){return l[e]||e})})},u=t.cr_bar.find(function(e){return 100===e[1]}),f=!!u&&t.p1_picks.includes(u[0]),p=(Ke(Ke(Ke(Ke(Ke(Ke(Ke(Ke(Ke(Ke(o={},d.SEASON,t.season_name||"None"),d.SEASON_CODE,t.season_code||"None"),d.DATE_TIME,t.date_time),d.SECONDS,t.seconds),d.TURNS,t.turns),d.SEQ_NUM,t.seq_num),d.P1_ID,t.p1_id.toString()),d.P1_SERVER,s[t.p1_server]||t.p1_server||"None"),d.P2_ID,t.p2_id.toString()),d.P2_SERVER,s[t.p2_server]||t.p2_server||"None"),Ke(Ke(Ke(Ke(Ke(Ke(Ke(Ke(Ke(Ke(o,d.P1_LEAGUE,e(t.p1_league)||"None"),d.P2_LEAGUE,e(t.p2_league)||"None"),d.P1_POINTS,t.p1_win_score),d.POINT_GAIN,t.p1_point_delta||null),d.WIN,1===t.win),d.FIRST_PICK,1===t.first_pick),d.FIRST_TURN,!!f),d.FIRST_TURN_HERO,u?a(u[0]):"n/a"),d.CR_BAR,t.cr_bar.map(function(e){return e&&2==e.length?[a(e[0]),e[1]]:["n/a",0]})),d.P1_PREBANS,t.p1_prebans.map(a)),Ke(Ke(Ke(Ke(Ke(Ke(Ke(Ke(Ke(Ke(o,d.P2_PREBANS,t.p2_prebans.map(a)),d.P1_PICKS,t.p1_picks.map(a)),d.P2_PICKS,t.p2_picks.map(a)),d.P1_POSTBAN,a(t.p1_postban)),d.P2_POSTBAN,a(t.p2_postban)),d.P1_EQUIPMENT,c(t.p1_equipment)),d.P2_EQUIPMENT,c(t.p2_equipment)),d.P1_ARTIFACTS,i("p1",t.p1_artifacts)),d.P2_ARTIFACTS,i("p2",t.p2_artifacts)),d.P1_MVP,a(t.p1_mvp)),Ke(o,d.P2_MVP,a(t.p2_mvp)));return $e(p,n),p}function He(e,t,n){n=null!=n?n:Be.getArtifactCodeToNameMap();var r,o=[],a=Ue(e);try{for(a.s();!(r=a.n()).done;){var i=Ge(r.value,t,n);o.push([i["Seq Num"],i])}}catch(e){a.e(e)}finally{a.f()}return Object.fromEntries(o)}function We(t,n){var r=t.map(function(t){var r,o=Ue(S);try{for(o.s();!(r=o.n()).done;){var a=r.value;t[a]=JSON.parse(t[a])}}catch(e){o.e(e)}finally{o.f()}var i,c=Ue(h);try{for(c.s();!(i=c.n()).done;){var s=i.value;t[s]="true"===t[s].toLowerCase()}}catch(e){c.e(e)}finally{c.f()}var u,l=Ue(y);try{for(l.s();!(u=l.n()).done;){var f=u.value;t[f]=Number(t[f].replace("'",""))}}catch(e){l.e(e)}finally{l.f()}var p,_=Ue(m);try{for(_.s();!(p=_.n()).done;){var d=p.value;t[d]=e(t[d])}}catch(e){_.e(e)}finally{_.f()}return $e(t,n),t});return Object.fromEntries(r.map(function(e){return[e["Seq Num"],e]}))}const Je={date:e=>e[d.DATE_TIME]?new Date(`${e[d.DATE_TIME].slice(0,10)}T00:00:00`):"N/A",season:e=>e[d.SEASON_CODE],"is-first-pick":e=>e[d.FIRST_PICK]?1:0,"is-win":e=>e[d.WIN]?1:0,"victory-points":e=>e[d.P1_POINTS],"p1.picks":e=>e[d.P1_PICKS],"p2.picks":e=>e[d.P2_PICKS],"p1.prebans":e=>e[d.P1_PREBANS],"p2.prebans":e=>e[d.P2_PREBANS],"p1.postban":e=>e[d.P1_POSTBAN],"p2.postban":e=>e[d.P2_POSTBAN],prebans:e=>[...e[d.P1_PREBANS],...e[d.P2_PREBANS]],"p1.pick1":e=>e[d.P1_PICKS][0],"p1.pick2":e=>e[d.P1_PICKS][1],"p1.pick3":e=>e[d.P1_PICKS][2],"p1.pick4":e=>e[d.P1_PICKS][3],"p1.pick5":e=>e[d.P1_PICKS][4],"p2.pick1":e=>e[d.P2_PICKS][0],"p2.pick2":e=>e[d.P2_PICKS][1],"p2.pick3":e=>e[d.P2_PICKS][2],"p2.pick4":e=>e[d.P2_PICKS][3],"p2.pick5":e=>e[d.P2_PICKS][4],"p1.league":e=>e[d.P1_LEAGUE],"p2.league":e=>e[d.P2_LEAGUE],"p1.server":e=>e[d.P1_SERVER],"p2.server":e=>e[d.P2_SERVER],"p1.id":e=>Number(e[d.P1_ID]),"p2.id":e=>Number(e[d.P2_ID]),"p1.mvp":e=>e[d.P1_MVP],"p2.mvp":e=>e[d.P2_MVP],"is-first-turn":e=>e[d.FIRST_TURN],"first-turn-hero":e=>e[d.FIRST_TURN_HERO],turns:e=>e[d.TURNS],seconds:e=>e[d.SECONDS],"point-gain":e=>e[d.POINT_GAIN]};function Ve(e,t="i"){return new RegExp(`^(?:${e.source})(?=[,)\\s;]|$)`,t)}function qe(e,t="i"){return new RegExp(`^(?:${e.source})$`,t)}function Qe(e,t="i"){if(e.length<1)throw new Error("orRegex must have at least one pattern");let n=`(?:${e[0].source})`;for(let t=1;t<e.length;t++)n+=`|(?:${e[t].source})`;return new RegExp(n,t)}const ze=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),Ye=Object.keys(Je),Ze=new RegExp(`^(?:${Ye.map(ze).join("|")})`,"i"),Xe=new RegExp(`(?:${["and","or","xor","not"].map(ze).join("|")})(?=\\()`,"i"),et=new RegExp(`(?:${["last-n"].map(ze).join("|")})(?=\\()`,"i"),tt=new RegExp(`(?:${["p1.equipment","p2.equipment","p1.artifact","p2.artifact","p1.cr","p2.cr"].map(ze).join("|")})(?=\\()`,"i"),nt=Qe([Xe,et,tt]),rt=/.*/i,ot=/\d{4}-\d{2}-\d{2}/,at=/\{\s*\}/,it=/-?\d+/,ct=/season-[1-9]+[0-9]*f?|current-season|last-season/i,st=/pvp_rta_ss[1-9]+[0-9]*f?/i,ut=new RegExp(`^${ot.source}$`,"i"),lt=new RegExp(`(?:${ct.source})`,"i"),ft=rt.source,pt=it.source,_t=ot.source,dt=Ze.source,St=lt.source,ht=new RegExp(`(["'])(${ft})\\1`,"i"),yt=qe(ht),mt=ht.source,Et=new RegExp(`(?:${mt}|${ft}|${_t})`,"i"),Pt=new RegExp(`(?:${dt}|${St})`,"i"),gt=Et.source,vt=new RegExp(`\\{\\s*(?:${gt}\\s*)(?:,\\s*${gt}\\s*)*,?\\s*\\}|${at.source}`,"i"),bt=new RegExp(`${pt}\\.\\.\\.=?${pt}|${_t}\\.\\.\\.=?${_t}`),wt=new RegExp(`^${bt.source}$`);let At={STRING_RE:rt,DATE_RE:ot,INT_RE:it,EMPTY_SET_RE:at,SET_ELEMENT_RE:Et,SET_RE:vt,SET_LITERAL_RE:qe(vt),STRING_LITERAL_RE:yt,DATE_LITERAL_RE:ut,INT_LITERAL_RE:/^-?\d+$/,BOOL_LITERAL_RE:/^(true|false)$/i,RANGE_RE:bt,RANGE_LITERAL_RE:wt,SEASON_RE:ct,SEASON_LITERAL_RE:qe(ct),SEASON_CODE_RE:st,SEASON_CODE_LITERAL_RE:qe(st),DATA_WORD_RE:lt,DATA_WORD_LITERAL_RE:qe(lt),FIELD_WORD_RE:Ze,FIELD_WORD_LITERAL_RE:qe(Ze),DATAFIELD_RE:Pt,GLOBAL_FILTER_RE:/last-n\(\d+\)/i,ANCHORED_STR_LITERAL_RE:qe(yt),CLAUSE_FUNCTIONS_RE:Xe,DIRECT_FUNCTIONS_RE:tt,GLOBAL_FUNCTIONS_RE:et,FUNCTIONS_RE:nt,FUNCTION_CALL_RE:/\(.*\)/i,padRegex:Ve,anchorExp:qe,tokenMatch:function(e){return e.match(nt)?"keyword":e.match(/\s+(?:!=|<|>|=|>=|<=|in|!in)(?=\s+)/i)?"operator":e.match(new RegExp(`[a-z0-9."'}=)-]${Pt.source}(?=[,)\\s;]|$)`,"i"))?null:e.match(Ve(Ze))?"field":e.match(Ve(lt))?"declared-data":e.match(Ve(ht))?"string":e.match(Ve(vt))?"set":e.match(Ve(bt))?"range":e.match(/[^(,\s;.=0-9\-]+\d+/i)?null:e.match(Ve(it))||e.match(Ve(ot))||e.match(/(?:^|\s)(?:true|false)(?=[,)\s;]|$)/i)?"declared-data":e.match(/[\(\)\{\}\;\,]/)?"bracket":(e.next(),null)},orRegex:Qe,escapeRegex:ze};class Tt extends Error{constructor(e){super(e),this.name="Filter Syntax Exception"}}class Rt extends Error{constructor(e){super(e),this.name="Filter Type Exception"}}class It extends Error{constructor(e){super(e),this.name="Filter Validation Error"}}const Nt={"(":")","{":"}",'"':'"',"'":"'"},Ot={"'":'"','"':"'"},Ct=Object.fromEntries(Object.entries(Nt).filter(([e,t])=>e!==t).map(([e,t])=>[t,e]));function Dt(e){const t={};for(const n of e)t[n]=(t[n]||0)+1;return t}const Lt={SyntaxException:Tt,TypeException:Rt,ValidationError:It,getCharCounts:Dt,tokenizeWithNestedEnclosures:function(e,t=" ",n=0,r=!0){const o=[];let a="",i=[];for(let c=0;c<e.length;c++){const s=e[c];if(t.includes(s)&&i.length===n)a&&(o.push(r?a.trim():a),a="");else if(Ct[s]){const t=Ct[s];if(i.length>n&&(a+=s),i[i.length-1]!==t){const t=Dt(e);throw(t["'"]||0)%2!=0||(t['"']||0)%2!=0?new Tt(`Error tokenizing: Unbalanced closing character at position ${c}; got string: '${e}' ; if a str type has quote characters in it, wrap it in the opposite quote character.`):new Tt(`Error tokenizing: Unbalanced closing character at position ${c}; got string: '${e}'`)}i.pop()}else i.length>=n&&(a+=s),!Nt[s]||Ot[s]&&i[i.length-1]===Ot[s]||(i[i.length-1]===Nt[s]&&s===Nt[s]?i.pop():i.push(s))}if(i.length>0)throw new Error(`Unbalanced enclosures in input string; unresolved characters from enclosure stack: [ ${i.join(", ")} ]`);return a&&o.push(r?a.trim():a),o},parseDate:function(e){if(!At.DATE_LITERAL_RE.test(e))throw new Tt(`Invalid date; must be in the format: YYYY-MM-DD ( regex: ${At.DATE_LITERAL_RE.source} ); got: '${e}'`);const t=e.split(" ")[0],n=new Date(`${t}T00:00:00`);if(isNaN(n.getTime()))throw new Tt(`Invalid date; could not be parsed as a valid date; got: '${e}'`);const r=n.toISOString().split("T")[0],[o,a,i]=r.split("-").map(Number);if(n.getFullYear()!==o||n.getMonth()+1!==a||n.getDate()!==i)throw new Tt(`Invalid date; parsed date: ${n.toISOString()} does not match passed in string: ${t}`);return n.toISOString(),n.constructor.name,n},tryConvert:function(e,t,n,r=null){null===r&&(r=`Could not convert ${n} to ${t}`);try{return e(n)}catch(e){throw new Rt(`${r}: ${e.message}`)}},trimSurroundingQuotes:function(e){return e.replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}},Mt=(new Set("'\"(),_-.=; ><!1234567890{}abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"),Object.fromEntries(Object.values(l).map(e=>[e.toLowerCase(),e])));class jt{}new class extends jt{parse(e,t){return ge.getHeroByName(e,t.HeroDicts)?.name??null}parserType="Hero"},new class extends jt{parse(e){return _[e]}parserType="League"},new class extends jt{parse(e){return u[e]}parserType="Server"},new class extends jt{parse(e){return Mt[e.toLowerCase()]}parserType="Equipment"},new class extends jt{parse(e,t){return t.ARTIFACT_LOWERCASE_STRINGS_MAP[e.toLowerCase()]}parserType="Artifact"},new class extends jt{parse(e,t){let n;if("current-season"===e)return t.SEASON_DETAILS[0].Code;if("last-season"===e)return t.SEASON_DETAILS[1].Code;if(At.SEASON_LITERAL_RE.test(e))n=e.split("-").at(-1);else{if(!At.SEASON_CODE_LITERAL_RE.test(e))return null;n=e.split("_ss").at(-1)}t.SEASON_DETAILS.map(e=>e.Code.split("_").at(-1));return t.SEASON_DETAILS.find(e=>e.Code.split("_ss").at(-1)===n)?.Code}parserType="Season Code"},new Set(["p1.picks","p2.picks","p1.prebans","p2.prebans","prebans"]);const kt={FIELD:"FIELD",RANGE:"RANGE",SET:"SET",INT:"INT",DATE:"DATE",BOOL:"BOOL",STRING:"STRING"};class Bt{}class Ft extends Bt{rawString;constructor(e){super(),this.rawString=e}getData(){return this.data}extractData(e){throw new Error("Not implemented for Literals")}asString(){return`${this.fmtString}`}}class Ut extends Ft{type=kt.INT;fmtString;data;constructor(e){super(e),this.data=this.processString(e),this.fmtString=e}processString(e){const t=parseInt(e);if(isNaN(t))throw new Lt.ValidationError(`Invalid integer literal: '${e}'`);return t}}class xt extends Ft{type=kt.DATE;fmtString;data;constructor(e){super(e),this.data=this.processString(e),this.fmtString=e}processString(e){return Lt.parseDate(e)}}const Kt=[e=>At.DATE_LITERAL_RE.test(e)?new xt(e):null,e=>At.INT_LITERAL_RE.test(e)?new Ut(e):null];const $t="GLOBAL_FN";class Gt{constructor(...e){}}class Ht extends Gt{}class Wt extends Gt{fnType=$t;asString(e=""){return`${e}${this.fnName}(${this.argFmtString})`}}function Jt(e){return Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jt(e)}function Vt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function qt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vt(Object(n),!0).forEach(function(t){Qt(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vt(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Qt(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=Jt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Jt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Jt(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function zt(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}throw new TypeError(Jt(e)+" is not iterable")}function Yt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,c=[],s=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=a.call(n)).done)&&(c.push(r.value),c.length!==t);s=!0);}catch(e){u=!0,o=e}finally{try{if(!s&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(u)throw o}}return c}}(e,t)||Xt(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Zt(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Xt(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw a}}}}function Xt(e,t){if(e){if("string"==typeof e)return en(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?en(e,t):void 0}}function en(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function tn(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var s=r&&r.prototype instanceof c?r:c,u=Object.create(s.prototype);return nn(u,"_invoke",function(n,r,o){var a,c,s,u=0,l=o||[],f=!1,p={p:0,n:0,v:e,a:_,f:_.bind(e,4),d:function(t,n){return a=t,c=0,s=e,p.n=n,i}};function _(n,r){for(c=n,s=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,a=l[t],_=p.p,d=a[2];n>3?(o=d===r)&&(s=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=_&&((o=n<2&&_<a[1])?(c=0,p.v=r,p.n=a[1]):_<d&&(o=n<3||a[0]>r||r>d)&&(a[4]=n,a[5]=r,p.n=d,c=0))}if(o||n>1)return i;throw f=!0,r}return function(o,l,d){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&_(l,d),c=l,s=d;(t=c<2?e:s)||!f;){a||(c?c<3?(c>1&&(p.n=-1),_(c,s)):p.n=s:p.v=s);try{if(u=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((t=(f=p.n<0)?s:n.call(r,p))!==i)break}catch(t){a=e,c=1,s=t}finally{u=1}}return{value:t,done:f}}}(n,o,a),!0),u}var i={};function c(){}function s(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(nn(t={},r,function(){return this}),t),f=u.prototype=c.prototype=Object.create(l);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,nn(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return s.prototype=u,nn(f,"constructor",u),nn(u,"constructor",s),s.displayName="GeneratorFunction",nn(u,o,"GeneratorFunction"),nn(f),nn(f,o,"Generator"),nn(f,r,function(){return this}),nn(f,"toString",function(){return"[object Generator]"}),(tn=function(){return{w:a,m:p}})()}function nn(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}nn=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){nn(e,t,function(e){return this._invoke(t,n,e)})};a("next",0),a("throw",1),a("return",2)}},nn(e,t,n,r)}function rn(e,t,n,r,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function on(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){rn(a,r,o,i,c,"next",e)}function c(e){rn(a,r,o,i,c,"throw",e)}i(void 0)})}}var an,cn,sn,un,ln,fn,pn,_n;const dn={loaded_servers:new Set,getBattles:(_n=on(tn().m(function e(){var t,n,r,o;return tn().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Pe.get(Pe.Keys.BATTLES);case 1:if(r=t=e.v,!(n=null!==r)){e.n=2;break}n=void 0!==t;case 2:if(!n){e.n=3;break}o=t,e.n=4;break;case 3:o=null;case 4:return e.a(2,o)}},e)})),function(){return _n.apply(this,arguments)}),removeBattles:(pn=on(tn().m(function e(){return tn().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Pe.delete(Pe.Keys.BATTLES);case 1:return e.n=2,Pe.delete(Pe.Keys.UPLOADED_BATTLES);case 2:return e.n=3,Pe.delete(Pe.Keys.FILTERED_BATTLES);case 3:case 4:return e.a(2)}},e)})),function(){return pn.apply(this,arguments)}),removeFilteredBattles:(fn=on(tn().m(function e(){return tn().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Pe.delete(Pe.Keys.FILTERED_BATTLES);case 1:case 2:return e.a(2)}},e)})),function(){return fn.apply(this,arguments)}),applyFilter:(ln=on(tn().m(function e(t){var n,r,o,a,i,c,s,u,l,f,p,_;return tn().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.getBattles();case 1:n=e.v,r=t.filter(function(e){return e instanceof Ht}),o=t.filter(function(e){return e instanceof Wt}),a=Object.values(n),i=Zt(o);try{for(i.s();!(c=i.n()).done;)s=c.value,"Applying global filter: ".concat(s.asString()),u=a.length,a=s.call(a),n=Object.fromEntries(a.map(function(e){return[e["Seq Num"],e]})),"Filtered ".concat(u-a.length," out of ").concat(u,"; new total = ").concat(a.length)}catch(e){i.e(e)}finally{i.f()}l=Zt(r),e.p=2,p=tn().m(function e(){var t,r;return tn().w(function(e){for(;;)switch(e.n){case 0:t=f.value,"Applying local filter: ".concat(t.asString()),r=Object.keys(n).length,n=Object.fromEntries(Object.entries(n).filter(function(e){var n=Yt(e,2),r=(n[0],n[1]);return t.call(r)})),"Filtered ".concat(r-Object.keys(n).length," out of ").concat(r,"; new total = ").concat(Object.keys(n).length);case 1:return e.a(2)}},e)}),l.s();case 3:if((f=l.n()).done){e.n=5;break}return e.d(zt(p()),4);case 4:e.n=3;break;case 5:e.n=7;break;case 6:e.p=6,_=e.v,l.e(_);case 7:return e.p=7,l.f(),e.f(7);case 8:return"Caching filtered battles ; total = ".concat(Object.keys(n).length),e.n=9,Pe.cache(Pe.Keys.FILTERED_BATTLES,n);case 9:return"Filtered battles and stored in cache; modified ['FILTERED_BATTLES']; Applied total of <".concat(r.length+o.length,"> filters"),e.a(2,n)}},e,this,[[2,6,7,8]])})),function(e){return ln.apply(this,arguments)}),extendBattles:(un=on(tn().m(function e(t){var n,r,o,a,i;return tn().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Pe.get(Pe.Keys.BATTLES);case 1:if(a=n=e.v,!(o=null!==a)){e.n=2;break}o=void 0!==n;case 2:if(!o){e.n=3;break}i=n,e.n=4;break;case 3:i={};case 4:return r=qt(qt({},i),t),e.n=5,Pe.cache(Pe.Keys.BATTLES,r);case 5:return e.a(2,r)}},e)})),function(e){return un.apply(this,arguments)}),cacheQuery:(sn=on(tn().m(function e(t,n,r){var o,a;return tn().w(function(e){for(;;)switch(e.n){case 0:if(t){e.n=1;break}return e.a(2,[]);case 1:return"Caching queried battles: ".concat(t.length," battles; modified [BATTLES];"),o=He(t,n,r),e.n=2,this.extendBattles(o);case 2:return a=e.v,e.a(2,a)}},e,this)})),function(e,t,n){return sn.apply(this,arguments)}),cacheUpload:(cn=on(tn().m(function e(t,n){var r,o;return tn().w(function(e){for(;;)switch(e.n){case 0:if(t){e.n=1;break}return console.error("No uploaded battles provided to cacheUpload"),e.a(2,{});case 1:return r=We(t,n),e.n=2,Pe.cache(Pe.Keys.UPLOADED_BATTLES,r);case 2:return e.n=3,this.extendBattles(r);case 3:return o=e.v,e.a(2,o)}},e,this)})),function(e,t){return cn.apply(this,arguments)}),getStats:(an=on(tn().m(function e(t,n,r){var o,a,i,c,s,u,l,f,p,_;return tn().w(function(e){for(;;)switch(e.n){case 0:return o=n.length,"Applying ".concat(o," filters"),a=Object.values(t),e.n=1,this.applyFilter(n);case 1:return i=e.v,c=Object.values(i),s=o>0,e.n=2,ke.getPrebanStats(c,r);case 2:return u=e.v,e.n=3,ke.getFirstPickStats(c,r);case 3:return l=e.v,e.n=4,ke.getGeneralStats(c,r);case 4:return f=e.v,e.n=5,ke.getHeroStats(c,r);case 5:return p=e.v,e.n=6,ke.getPerformanceStats(c);case 6:return _=e.v,e.a(2,{battles:a,filteredBattlesObj:i,prebanStats:u,generalStats:f,firstPickStats:l,playerHeroStats:p.playerHeroStats,enemyHeroStats:p.enemyHeroStats,performanceStats:_,numFilters:o,areFiltersApplied:s})}},e,this)})),function(e,t,n){return an.apply(this,arguments)})};function Sn(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var s=r&&r.prototype instanceof c?r:c,u=Object.create(s.prototype);return hn(u,"_invoke",function(n,r,o){var a,c,s,u=0,l=o||[],f=!1,p={p:0,n:0,v:e,a:_,f:_.bind(e,4),d:function(t,n){return a=t,c=0,s=e,p.n=n,i}};function _(n,r){for(c=n,s=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,a=l[t],_=p.p,d=a[2];n>3?(o=d===r)&&(s=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=_&&((o=n<2&&_<a[1])?(c=0,p.v=r,p.n=a[1]):_<d&&(o=n<3||a[0]>r||r>d)&&(a[4]=n,a[5]=r,p.n=d,c=0))}if(o||n>1)return i;throw f=!0,r}return function(o,l,d){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&_(l,d),c=l,s=d;(t=c<2?e:s)||!f;){a||(c?c<3?(c>1&&(p.n=-1),_(c,s)):p.n=s:p.v=s);try{if(u=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((t=(f=p.n<0)?s:n.call(r,p))!==i)break}catch(t){a=e,c=1,s=t}finally{u=1}}return{value:t,done:f}}}(n,o,a),!0),u}var i={};function c(){}function s(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(hn(t={},r,function(){return this}),t),f=u.prototype=c.prototype=Object.create(l);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,hn(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return s.prototype=u,hn(f,"constructor",u),hn(u,"constructor",s),s.displayName="GeneratorFunction",hn(u,o,"GeneratorFunction"),hn(f),hn(f,o,"Generator"),hn(f,r,function(){return this}),hn(f,"toString",function(){return"[object Generator]"}),(Sn=function(){return{w:a,m:p}})()}function hn(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}hn=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){hn(e,t,function(e){return this._invoke(t,n,e)})};a("next",0),a("throw",1),a("return",2)}},hn(e,t,n,r)}function yn(e,t,n,r,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function mn(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){yn(a,r,o,i,c,"next",e)}function c(e){yn(a,r,o,i,c,"throw",e)}i(void 0)})}}var En,Pn,gn,vn={fetchAndCacheSeasonDetails:(gn=mn(Sn().m(function e(){var t,n,r,o,a,i,c;return Sn().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,W.fetchSeasonDetails();case 1:if(!(t=e.v).error){e.n=2;break}throw new Error("Could not fetch season details: ".concat(t.error));case 2:return(n=t.seasonDetails).forEach(function(e){e.range=[e.Start,e.End].map(function(e){return new Date("".concat(e.split(" ")[0],"T00:00:00"))}),e["Season Number"]=String(e["Season Number"])}),n.sort(function(e,t){return parseInt(e["Season Number"])-parseInt(t["Season Number"])}),r=[n[0]],o=n[0],n.slice(1).forEach(function(e){var t=new Date(+o.range[1]+f),n=new Date(+e.range[0]-f),a=o["Season Number"]+"f",i={"Season Number":a,Code:"pvp_rta_ss"+a,Season:"Pre ".concat(e.Season),Start:t.toISOString().slice(0,10),End:n.toISOString().slice(0,10),Status:"Complete",range:[t,n]};r.push(i),r.push(e),o=e}),o.range[1]<new Date&&(a=new Date(+r.at(-1).range[1]+f),i=o["Season Number"]+"f",c={"Season Number":i,Code:"pvp_rta_ss"+i,Season:"Active Pre-Season",Start:a.toISOString().slice(0,10),End:"N/A",Status:"Active",range:[a,new Date]},r.push(c)),r.reverse(),e.n=3,Pe.cache(Pe.Keys.SEASON_DETAILS,r);case 3:return e.a(2,r)}},e)})),function(){return gn.apply(this,arguments)}),getSeasonDetails:(Pn=mn(Sn().m(function e(){var t,n;return Sn().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Pe.get(Pe.Keys.SEASON_DETAILS);case 1:if(null==(t=e.v)){e.n=2;break}n=t,e.n=4;break;case 2:return e.n=3,vn.fetchAndCacheSeasonDetails();case 3:n=e.v;case 4:return e.a(2,n)}},e)})),function(){return Pn.apply(this,arguments)}),clearSeasonDetails:(En=mn(Sn().m(function e(){return Sn().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Pe.delete(Pe.Keys.SEASON_DETAILS);case 1:case 2:return e.a(2)}},e)})),function(){return En.apply(this,arguments)}),getSeasonNumFromCode:function(e){return e.split("_")[-1]}};const bn=vn,wn={[r]:Pe.Keys.GLOBAL_USERS,[c]:Pe.Keys.EU_USERS,[i]:Pe.Keys.ASIA_USERS,[a]:Pe.Keys.JPN_USERS,[o]:Pe.Keys.KOR_USERS};function An(e,t){return{id:e.nick_no,name:e.nick_nm,code:e.code,rank:e.rank,world_code:t}}async function Tn(e){const t=await Pe.get(wn[e]);if(null!==t)return t;const n=await async function(e){const t=await M.fetchUserJSON(e);if(!t||"object"==typeof t&&!("users"in t))return null;const n=t;return Object.fromEntries(n.users.map(t=>[t.nick_no,An(t,e)]))}(e);return await Pe.cache(wn[e],n),n}const Rn=e=>s[e];async function In(e,t){const n=await Tn(t),r=n?Object.values(n):[];if(0===r.length)return Rn(t),{user:null,ok:!1};let o,a;if(e.id)o=e.id,a=e=>e.id;else{if(!e.name)throw new Error("Must pass a user object with either user.name or user.id to find user");o=e.name.toLowerCase(),a=e=>e.name.toLowerCase()}return function(e,t,n){const r=t.find(t=>n(t)===e);return r?(JSON.stringify(r),{user:r,ok:!0}):{user:null,ok:!0}}(o,r,a)}let Nn={HeroManager:ge,BattleManager:dn,SeasonManager:bn,UserManager:{getUserMap:Tn,findUser:async function(e){if(JSON.stringify(e),!e.name&&!e.id||!e.world_code)throw new Error("Must pass a user object with either user.name or user.id, and user.world_code to find user");let t=e.id?`Numeric ID: ${e.id}`:`Name: '${e.name}'`,n=null;if(n=await In(e,e.world_code),n.ok||(n=await W.fetchUser(e)),n.ok){const r=n.user;if(null===r)throw new Error(`Could not find user with ${t} in Server: ${Rn(e.world_code)}`);return r}throw new Error(`Function did not properly terminate: ${JSON.stringify(n)}`)},setUser:async function(e){await Pe.cache(Pe.Keys.USER,e)},getUser:async function(){return await Pe.get(Pe.Keys.USER)},clearUserData:async function(){await Pe.clearUserData()},clearUserDataLists:async function(){await Pe.clearUserLists()}},ClientCache:Pe,ArtifactManager:Be,LangManager:{changeLang:async function(e){await Nn.ClientCache.setLang(e),await Nn.HeroManager.fetchAndCacheHeroManager(e),window.location.reload()},getLang:async function(){return await Nn.ClientCache.getLang()}}};function On(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var s=r&&r.prototype instanceof c?r:c,u=Object.create(s.prototype);return Cn(u,"_invoke",function(n,r,o){var a,c,s,u=0,l=o||[],f=!1,p={p:0,n:0,v:e,a:_,f:_.bind(e,4),d:function(t,n){return a=t,c=0,s=e,p.n=n,i}};function _(n,r){for(c=n,s=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,a=l[t],_=p.p,d=a[2];n>3?(o=d===r)&&(s=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=_&&((o=n<2&&_<a[1])?(c=0,p.v=r,p.n=a[1]):_<d&&(o=n<3||a[0]>r||r>d)&&(a[4]=n,a[5]=r,p.n=d,c=0))}if(o||n>1)return i;throw f=!0,r}return function(o,l,d){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&_(l,d),c=l,s=d;(t=c<2?e:s)||!f;){a||(c?c<3?(c>1&&(p.n=-1),_(c,s)):p.n=s:p.v=s);try{if(u=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((t=(f=p.n<0)?s:n.call(r,p))!==i)break}catch(t){a=e,c=1,s=t}finally{u=1}}return{value:t,done:f}}}(n,o,a),!0),u}var i={};function c(){}function s(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(Cn(t={},r,function(){return this}),t),f=u.prototype=c.prototype=Object.create(l);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,Cn(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return s.prototype=u,Cn(f,"constructor",u),Cn(u,"constructor",s),s.displayName="GeneratorFunction",Cn(u,o,"GeneratorFunction"),Cn(f),Cn(f,o,"Generator"),Cn(f,r,function(){return this}),Cn(f,"toString",function(){return"[object Generator]"}),(On=function(){return{w:a,m:p}})()}function Cn(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Cn=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){Cn(e,t,function(e){return this._invoke(t,n,e)})};a("next",0),a("throw",1),a("return",2)}},Cn(e,t,n,r)}function Dn(e){return Dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dn(e)}function Ln(e,t,n,r,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function Mn(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Ln(a,r,o,i,c,"next",e)}function c(e){Ln(a,r,o,i,c,"throw",e)}i(void 0)})}}document.addEventListener("DOMContentLoaded",Mn(On().m(function e(){var t;return On().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Nn.ClientCache.clearData();case 1:return e.n=2,bn.getSeasonDetails();case 2:return Dn(t=e.v),t.length,e.n=3,Nn.HeroManager.getHeroDicts();case 3:return e.v,e.n=4,M.fetchInfo(119456895,"world_korea");case 4:return e.v,e.n=5,M.fetchInfo(195863691,"world_global");case 5:e.v;case 6:return e.a(2)}},e)})))})();