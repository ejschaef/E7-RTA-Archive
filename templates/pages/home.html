{% extends "layouts/base-home.html" %}

{% block title %}Home{% endblock title %}

{% block content %}
<div class="pc-container d-none" data-bs-theme="dark" id="select-data-body">
    <div class="pc-content" data-bs-theme="dark">

        <!-- [ Main Content ] start -->
        <div class="row justify-content-center">
            <!-- [ feather-icon ] start -->
            <div class="col-md-9">
                <div class="card">
                    <div class="card-header thin-header text-center">
                        <h4>Select Data</h4>
                    </div>
                    <div class="card-body text-center px-5 py-0">
                        <div class="row justify-content-center">
                            <span id="select-data-msg" class="d-inline-block text-danger mt-2"></span>
                            <div class="px-5 mt-2 mb-2">
                                <form id="userForm" method="post">
                                    <h6 class="text-center f-w-500 mb-2">Query E7 Server</h6>
                                    {{ query_form.hidden_tag() }}
                                    <div class="form-group mb-3">
                                        {{ query_form.username(placeholder="E7 Username / ID", class="form-control
                                        custom-input")
                                        }}
                                    </div>
                                    <div class="form-group mb-3">
                                        {{ query_form.server(placeholder="Server", class="form-control ") }}
                                    </div>
                                    <div class="d-flex justify-content-start text-center gap-4 mt-1">
                                        <button type="submit" name="user_query"
                                            class="btn btn-primary shadow px-sm-4">Query
                                            User</button>
                                        <span class="toggle-container" id="id-search-toggle-container">
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="id-search-flag" checked>
                                                <span class="toggle-switch-background">
                                                    <span class="toggle-switch-handle"></span>
                                                </span>
                                            </label>
                                            <h6>Search With ID</h6>
                                        </span>
                                    </div>
                                </form>
                            </div>
                            <hr>
                            <div class="px-5 mt-0 mb-3">
                                <form id="uploadForm">
                                    {{ upload_form.hidden_tag() }}
                                    <h6 class="text-center f-w-500 mb-3">Upload CSV</h6>
                                    <div class="form-group mb-3">
                                        {{ upload_form.file(class="form-control", id="csvFile") }}
                                    </div>
                                    <div class="d-flex justify-content-start text-center gap-4 mt-1">
                                        <button type="submit" name="battle_data"
                                            class="btn btn-primary shadow px-sm-4">Submit File</button>
                                        <span class="toggle-container" id="auto-query-toggle-container">
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="auto-query-flag" checked>
                                                <span class="toggle-switch-background">
                                                    <span class="toggle-switch-handle"></span>
                                                </span>
                                            </label>
                                            <h6> Auto-Query New Battles</h6>
                                        </span>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- [ Main Content ] end -->
    </div>
</div>


<div class="pc-container d-none" id="load-data-body">
    <div class="pc-content">
        <div class="loader-overlay">
            <button type="button" class="btn btn-primary shadow px-sm-4" id="escape-btn">Escape</button>
            <div class="loader-content">
                <h2>Content Loading</h2>
                <div class="loader"></div>
            </div>
        </div>
    </div>
</div>


<div class="pc-container d-none" id="show-stats-body">
    <div class="pc-content">
        <!-- [ Main Content ] start -->
        <div class="row">

            <!-- [ season details table ] start -->
            <div class="col-md-6">
                <div class="card height-400">
                    <div class="card-header kpi-header">
                        <h5 class="text-white">Season Details</h5>
                    </div>
                    <div class="card-body kpi-body rel-height-80">
                        <div class="rel-height-100">
                            <table id="SeasonDetails"
                                class="scrollables interior-border-tbl clean-table align-center-except-second col1-justify-start col2-30 col1-w-30 f-12">
                                <thead>
                                    <tr>
                                        <th scope="col"></th>
                                        <th scope="col">Season</th>
                                        <th scope="col">Start</th>
                                        <th scope="col">End</th>
                                        <th scope="col">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="SeasonDetailsBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!-- [ season details table ] end -->

            <!-- [ filter code mirror ] start -->
            <div class="col-md-6">
                <div class="card height-400">
                    <div class="card-header kpi-header">
                        <h5>Filter battles for calculations</h5>
                    </div>
                    <div class="card-body text-center tight-fit rel-height-100">
                        <div class="row justify-content-center">
                            <div class="d-flex justify-content-between align-items-center mt-2 w-100 px-2">
                                <div class="dropdown">
                                    <button class="btn btn-secondary dropdown-toggle filter-pane-btn ms-3" type="button"
                                        id="filter-select" data-bs-toggle="dropdown" aria-expanded="false">
                                        Premade Filters
                                    </button>
                                    <ul class="dropdown-menu scrollable-300px f-12" aria-labelledby="filter-select"
                                        id="premade-filters">
                                        <li><button type="button" class="dropdown-item">Current Season</button></li>
                                        <li><button type="button" class="dropdown-item">First Pick</button></li>
                                        <li><button type="button" class="dropdown-item">Second Pick</button></li>
                                        <li><button type="button" class="dropdown-item">Wins</button></li>
                                        <li><button type="button" class="dropdown-item">Losses</button></li>
                                        <li><button type="button" class="dropdown-item">Champion+ Opponent</button></li>
                                        <li><button type="button" class="dropdown-item">Warlord+ Opponent</button></li>
                                        <li><button type="button" class="dropdown-item">Emperor+ Opponent</button></li>
                                        <li><button type="button" class="dropdown-item">Legend Opponent</button></li>
                                    </ul>
                                </div>
                                <span class="d-block me-3 rel-width-60 scrollable-40px f-10"
                                    id="filterMSG">&nbsp;</span>
                            </div>
                            <form method="post" id="filterForm" class="card-body">
                                {{ filter_form.hidden_tag() }}
                                <textarea id="codeArea" name="code"
                                    class="codemirror-hidden">{{ code or '' }}</textarea>
                                <div class="d-flex justify-content-center gap-3 mt-4">
                                    <button type="submit" name="check-syntax" value="check"
                                        class="btn shadow px-sm-1 filter-pane-btn">Check Syntax</button>
                                    <button type="submit" name="apply-filter" value="apply"
                                        class="btn shadow px-sm-1 filter-pane-btn">Apply Filter</button>
                                    <button type="submit" name="clear-filter" value="clear"
                                        class="btn shadow px-sm-1 filter-pane-btn">Clear Filter</button>
                                    <div class="toggle-container-vertical" id="auto-zoom-toggle-container">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="auto-zoom-flag">
                                            <span class="toggle-switch-background">
                                                <span class="toggle-switch-handle"></span>
                                            </span>
                                        </label>
                                        <span class="filter-pane-btn">Auto-Zoom</span>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!-- [ filter code mirror ] end -->


            <!-- [ general stats section ] start -->
            <div class="col-md-4 d-flex flex-column gap">
                <div class="card">
                    <div class="card-body">
                        <div class="row d-flex align-items-center">
                            <div class="col-8">
                                <p class="f-w-200 f-14 d-flex align-items-center m-b-0">Total Battles:</p>
                            </div>
                            <div class="col-4 text-align-left px-0">
                                <p class="f-w-200 f-14 d-inline m-b-0" id="total-battles">&nbsp;</p>
                            </div>
                            <div class="col-8">
                                <p class="f-w-200 f-14 d-inline align-items-center m-b-0">Total Wins:</p>
                            </div>
                            <div class="col-4 px-0">
                                <p class="f-w-200 f-14 d-inline text-align-left m-b-0" id="total-wins">&nbsp;</p>
                            </div>
                            <div class="col-8">
                                <p class="f-w-200 f-14 d-inline align-items-center m-b-0">Total Win Rate:</p>
                            </div>
                            <div class="col-4 px-0">
                                <p class="f-w-200 f-14 d-inline text-align-left m-b-0" id="total-winrate">&nbsp;</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body">
                        <div class="row d-flex align-items-center">
                            <div class="col-8">
                                <p class="f-w-200 f-14 d-flex align-items-center m-b-0">1st Pick Games:</p>
                            </div>
                            <div class="col-4 text-align-left px-0">
                                <p class="f-w-200 f-14 d-inline m-b-0" id="first-pick-count">&nbsp;</p>
                                <p class="d-inline f-w-100 f-8 m-b-0" id="first-pick-rate">&nbsp;</p>
                            </div>
                            <div class="col-8">
                                <p class="f-w-200 f-14 d-flex align-items-center m-b-0">2nd Pick Games:</p>
                            </div>
                            <div class="col-4 text-align-left px-0">
                                <p class="f-w-200 f-14 d-inline  m-b-0" id="second-pick-count">&nbsp;</p>
                                <p class="d-inline f-w-100 f-8 m-b-0" id="second-pick-rate">&nbsp;</p>
                            </div>
                            <div class="col-8">
                                <p class="f-w-200 f-14 d-inline align-items-center m-b-0">1st Pick Win Rate:</p>
                            </div>
                            <div class="col-4 px-0">
                                <p class="f-w-200 f-14 d-inline text-align-left m-b-0" id="first-pick-winrate">&nbsp;</p>
                            </div>
                            <div class="col-8">
                                <p class="f-w-200 f-14 d-inline align-items-center m-b-0">2nd Pick Win Rate:</p>
                            </div>
                            <div class="col-4 px-0">
                                <p class="f-w-200 f-14 d-inline text-align-left m-b-0" id="second-pick-winrate">&nbsp;</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body">
                        <div class="row d-flex align-items-center">
                            <div class="col-8 ">
                                <p class="f-w-200 f-14 d-inline align-items-center m-b-0">Avg PPG:</p>
                            </div>
                            <div class="col-4 px-0">
                                <p class="f-w-200 f-14 d-inline text-align-left m-b-0" id="avg-ppg">&nbsp;</p>
                            </div>
                            <div class="col-8">
                                <p class="f-w-200 f-14 d-inline align-items-center m-b-0">Max Win Streak:</p>
                            </div>
                            <div class="col-4 px-0">
                                <p class="f-w-200 f-14 d-inline text-align-left m-b-0" id="max-win-streak">&nbsp;</p>
                            </div>
                            <div class="col-8">
                                <p class="f-w-200 f-14 d-inline align-items-center m-b-0">Max Loss Streak:</p>
                            </div>
                            <div class="col-4 px-0">
                                <p class="f-w-200 f-14 d-inline text-align-left m-b-0" id="max-loss-streak">&nbsp;</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- [ general stats section ] end -->

            <!-- [ server stats table ] start -->
            <div class="col-md-8 min-width-450 mb-24px">
                <div class="card h-100">
                    <div class="card-header kpi-header">
                        <h5 class="text-white">Server Stats</h5>
                        <p class="f-w-100 f-10 mb-0" id="first-pick-rate">(FP WR = First Pick Win Rate, SP WR = Second
                            Pick Win Rate)</p>
                    </div>
                    <div class="card-body kpi-body rel-height-80">
                        <div class="rel-height-100">
                            <table id="server-stats"
                                class="interior-border-tbl clean-table align-center-except-first col1-150 f-16">
                                <thead>
                                    <tr>
                                        <th scope="col"></th>
                                        <th scope="col">Battles</th>
                                        <th scope="col">Freq</th>
                                        <th scope="col">Wins</th>
                                        <th scope="col">Win Rate</th>
                                        <th scope="col">+/-</th>
                                        <th scope="col">FP WR</th>
                                        <th scope="col">SP WR</th>
                                    </tr>
                                </thead>
                                <tbody id="server-stats-body">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!-- [ server stats table ] end -->

            <!-- [ General stats array section ] start -->
             <div class="col-sm-4 d-flex">
                <div class="card w-100">
                    <div class="card-body w-100">
                        <div class="row d-flex align-items-center">
                            <div class="col-8">
                                <p class="f-w-200 f-14 d-flex align-items-center m-b-0">Avg Time:</p>
                            </div>
                            <div class="col-4 text-align-left px-0">
                                <p class="f-w-200 f-14 d-inline m-b-0" id="avg-time">&nbsp;</p>
                            </div>
                            <div class="col-8">
                                <p class="f-w-200 f-14 d-inline align-items-center m-b-0">Max Time:</p>
                            </div>
                            <div class="col-4 px-0">
                                <p class="f-w-200 f-14 d-inline text-align-left m-b-0" id="max-time">&nbsp;</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-4 d-flex">
                <div class="card w-100">
                    <div class="card-body w-100">
                        <div class="row d-flex align-items-center">
                            <div class="col-8">
                                <p class="f-w-200 f-14 d-flex align-items-center m-b-0">Avg Turns:</p>
                            </div>
                            <div class="col-4 text-align-left px-0">
                                <p class="f-w-200 f-14 d-inline m-b-0" id="avg-turns">&nbsp;</p>
                            </div>
                            <div class="col-8">
                                <p class="f-w-200 f-14 d-inline align-items-center m-b-0">Max Turns:</p>
                            </div>
                            <div class="col-4 px-0">
                                <p class="f-w-200 f-14 d-inline text-align-left m-b-0" id="max-turns">&nbsp;</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-4 d-flex">
                <div class="card w-100">
                    <div class="card-body w-100">
                        <div class="row d-flex align-items-center">
                            <div class="col-8">
                                <p class="f-w-200 f-14 d-flex align-items-center m-b-0">1st Turn Games:</p>
                            </div>
                            <div class="col-4 text-align-left px-0">
                                <p class="f-w-200 f-14 d-inline m-b-0" id="first-turn-games">&nbsp;</p>
                            </div>
                            <div class="col-8">
                                <p class="f-w-200 f-14 d-inline align-items-center m-b-0">1st Turn Rate:</p>
                            </div>
                            <div class="col-4 px-0">
                                <p class="f-w-200 f-14 d-inline text-align-left m-b-0" id="first-turn-rate">&nbsp;</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- [ General stats array section ] end -->


            <!-- [ first pick stats table ] start -->
            <div class="col-xl-6 min-width-450">
                <div class="card height-300">
                    <div class="card-header kpi-header">
                        <h5 class="text-white">First Pick Hero Stats</h5>
                    </div>
                    <div class="card-body kpi-body rel-height-80">
                        <div class="rel-height-100">
                            <table id="FirstPickStats"
                                class="scrollables interior-border-tbl clean-table align-center-except-first col1-150">
                                <thead>
                                    <tr>
                                        <th scope="col">Hero</th>
                                        <th scope="col">Battles</th>
                                        <th scope="col">Pick Rate</th>
                                        <th scope="col">Win Rate</th>
                                        <th scope="col">+/-</th>
                                    </tr>
                                </thead>
                                <tbody id="FirstPickStatsBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!-- [ first pick stats table ] end -->


            <!-- [ preban stats table ] start -->
            <div class="col-xl-6 min-width-450">
                <div class="card height-300">
                    <div class="card-header kpi-header">
                        <h5 class="text-white">Preban Stats</h5>
                    </div>
                    <div class="card-body kpi-body rel-height-80">
                        <div class="rel-height-100">
                            <table id="PrebanStats"
                                class="scrollables interior-border-tbl clean-table align-center-except-first col1-150">
                                <thead>
                                    <tr>
                                        <th scope="col">Preban</th>
                                        <th scope="col">Battles</th>
                                        <th scope="col">Ban Rate</th>
                                        <th scope="col">Win Rate</th>
                                        <th scope="col">+/-</th>
                                    </tr>
                                </thead>
                                <tbody id="PrebanStatsBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!-- [ preban stats table ] end -->


            <!-- [ plot section ] start -->
            <div class="col-lg-12 w-100" id="rank-plot-col">
                <div class="card w-100">
                    <div id="rank-plot-container" class="w-100"></div>
                </div>
            </div>

            <script>
                setTimeout(() => {
                    window.dispatchEvent(new Event('resize'));
                }, 10);
            </script>
            <!-- [ plot section ] end -->

            <!-- [ player hero stats section ] start -->
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-header fixed-height-table-header kpi-header">
                        <h5>Player Heroes</h5>
                        <br>
                        <h6 style="font-size: 0.7em;">
                            Displays statistics for heroes computed
                            based on when they appear on the player's team. Success Rate indicates percentage of
                            games in which the player won the game or the hero was post banned.
                        </h6>
                    </div>
                    <div class="card-body kpi-body">
                        <table id="PlayerTable" class="display compact cell-border" style="width:100%">
                            <thead>
                                <tr>
                                    <th scope="col">Hero Name</th>
                                    <th scope="col">Battles</th>
                                    <th scope="col">Pick Rate</th>
                                    <th scope="col">Wins</th>
                                    <th scope="col">Win rate</th>
                                    <th scope="col">Postban Rate</th>
                                    <th scope="col">Success Rate</th>
                                    <th scope="col">+/-</th>
                                    <th scope="col">Point Gain</th>
                                    <th scope="col">Avg CR</th>
                                    <th scope="col">First Turn Rate</th>
                                </tr>
                            </thead>
                            <tbody id="PlayerTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- [ player hero stats section ] end -->

            <!-- [ opponent hero stats section ] start -->
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-header fixed-height-table-header kpi-header">
                        <h5>Enemy Heroes</h5>
                        <br>
                        <h6 style="font-size: 0.7em;">
                            Displays statistics for heroes computed based on when they appear on the enemy team.
                            Win rate and +/- are relative to the player; pick rate is relative to the opponent.
                        </h6>
                    </div>
                    <div class="card-body kpi-body">
                        <table id="OpponentTable" class="display compact cell-border" style="width:100%">
                            <thead>
                                <tr>
                                    <th scope="col">Hero Name</th>
                                    <th scope="col">Battles</th>
                                    <th scope="col">Pick Rate</th>
                                    <th scope="col">Wins</th>
                                    <th scope="col">Win rate</th>
                                    <th scope="col">Postban Rate</th>
                                    <th scope="col">+/-</th>
                                    <th scope="col">Point Gain</th>
                                    <th scope="col">Avg CR</th>
                                    <th scope="col">First Turn Rate</th>
                                </tr>
                            </thead>
                            <tbody id="OpponentTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- [ opponent hero stats section ] end -->

            <!-- [ battles df section ] start -->
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-header text-center kpi-header">
                        <h3>Player Battles</h3>
                        <h5 style="font-size: 0.7em;">
                            Displays information for each of the player's battles. Export this table and upload to
                            maintain history. Two star heroes will show as 'Fodder'.
                        </h5>
                    </div>
                    <div class="card-body kpi-body">
                        <div class="toggle-container" id="filter-battle-toggle-container">
                            <label class="toggle-switch">
                                <input type="checkbox" id="filter-battle-table">
                                <span class="toggle-switch-background">
                                    <span class="toggle-switch-handle"></span>
                                </span>
                            </label>
                            <h6>Apply Filters to Table</h6>
                        </div>
                        <table id="BattlesTable" class="display compact cell-border" style="width:100%">
                            <thead>
                                <tr>
                                    <th scope="col">Season</th>
                                    <th scope="col">Season Code</th>
                                    <th scope="col">Date/Time</th>
                                    <th scope="col">Seconds</th>
                                    <th scope="col">Turns</th>
                                    <th scope="col">Seq Num</th>
                                    <th scope="col">P1 ID</th>
                                    <th scope="col">P1 Server</th>
                                    <th scope="col">P2 ID</th>
                                    <th scope="col">P2 Server</th>
                                    <th scope="col">P1 League</th>
                                    <th scope="col">P2 League</th>
                                    <th scope="col">P1 Points</th>
                                    <th scope="col">Point Gain</th>
                                    <th scope="col">Win</th>
                                    <th scope="col">First Pick</th>
                                    <th scope="col">First Turn</th>
                                    <th scope="col">First Turn Hero</th>
                                    <th scope="col">CR Bar</th>
                                    <th scope="col">P1 Prebans</th>
                                    <th scope="col">P2 Prebans</th>
                                    <th scope="col">P1 Picks</th>
                                    <th scope="col">P2 Picks</th>
                                    <th scope="col">P1 Postban</th>
                                    <th scope="col">P2 Postban</th>
                                    <th scope="col">P1 Equipment</th>
                                    <th scope="col">P2 Equipment</th>
                                    <th scope="col">P1 Artifacts</th>
                                    <th scope="col">P2 Artifacts</th>
                                    <th scope="col">P1 MVP</th>
                                    <th scope="col">P2 MVP</th>
                                </tr>
                            </thead>
                            <tbody id="BattlesTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- [ battles df stats section ] end -->
        </div>
    </div>
</div>
{% endblock content %}

{% block extra_js %}

<script type="module" src="{{ get_manifest(filename='home-page.js') }}"></script>

{% endblock extra_js %}